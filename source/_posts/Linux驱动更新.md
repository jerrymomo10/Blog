title: Linux驱动更新
date: 2016-01-21 19:01:54
tags: [Linux，kernel，GPU]
categories: [Linux]
---
多少次因为Ubuntu Kernels的更新造成系统不能进入，图形化界面登陆失败的问题，今天又一次遇到关于内核更新造成的显卡驱动不正常，一直在闪屏的问题。显卡是GTX770，系统是15.04,回想一下大概是几个小时以前自己更新了boot/下的kernel造成的，从4.2.0-19到 4.2.0-23，幸亏当时更新完以后没有删除旧的的kernel，在开机的grub里进入高级选项还能选择旧的kernel，果不其然，从旧的kernel进入的话显卡驱动正常，能正常的进入系统，这就好办了，重新添加了显卡的PPA，update,然后安装最新的显卡驱动nvidia-361,重启电脑，怎么还是闪屏。哪里不对？
开机以后重新进入的是－23的内核，难道重新编译过的内核只有-19？
重启高级选项进入－19的内核，还是同样的问题，所以重新安装的驱动也不合适。
进入命令行模式，卸载掉所有的nvidia-*，终于正常了，显示没有问题了，开机也正常，但是这样没有nvidia的专用显卡驱动，我没法用gpu进行计算，没法双屏幕显示了啊。
卸载掉所有的非-19kernel到nvidia官网看了一下，这个驱动的版本并不是越高越好，也不是后向兼容的，gtx770显卡，合适的驱动是nvidia-352.63,所以最初安装的驱动是nvidia－361可能是不合适的，那么卸载掉所有的旧的nvidia-*，然后重新安装nvidia-352.63。


----------
有两点要注意，内核升级的时候，不要立马删掉旧的内核，最好保存最近能用的内核。几个常用的命令是
　`uname -r`

显示现在正在使用的内核，无法被删除。
　`sudo dpkg --list'linux-image*'`

显示目前的系统中有那些kernels。

    sudo apt-get remove linux-image-VERSION
删除不要的kernel。

    sudo update-grub
更新grub

linux的显卡驱动在kernel中，所以每一次安装新的显卡驱动都会更新kernel。
ubuntu下的显卡驱动安装显然比redhat系列要简单很多，fedora下安装显卡驱动的时候要自己源码编译内核，所以当时把fedora22搞奔溃了，然后才换到了ubuntu,ubuntu的ppa比较多，就拿显卡驱动来说，nvidia的ppa维护的非常好，经常更新，安装十分方便，当然显卡驱动比较大，有60M，所以选择优秀的源也很重要了。
